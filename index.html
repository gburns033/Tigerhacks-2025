<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Mars Viewer</title>
  <!-- Cesium library -->
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.123/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.123/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <style>
    html,
    body,
    #cesiumContainer {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      display: block;
    }
  </style>
</head>

<body>
  <!-- The DOM container where Cesium will render the globe -->
  <div id="cesiumContainer"></div>
  <script src="config.js"></script>
  <script>
    const { TITILER_URL, FLASK_URL, MARS_TIF } = window.__ENV__;
    const tileUrl = `${TITILER_URL}/cog/tiles/WorldCRS84Quad/{z}/{x}/{y}@1x?url=${FLASK_URL}/${MARS_TIF}&colormap_name=inferno`;

    const viewer = new Cesium.Viewer("cesiumContainer", {
      imageryProvider: false,
      baseLayerPicker: false,
      animation: false,
      timeline: false,
      creditContainer: document.createElement('div'),
    });

    viewer.scene.globe.ellipsoid = new Cesium.Ellipsoid(
      3396190.0,
      3396190.0,
      3376200.0
    );

    // Set zoom limits in meters (distance from the ellipsoid or terrain)
    viewer.scene.screenSpaceCameraController.minimumZoomDistance = 4.0e5;  // min ~4,000 km above surface
    viewer.scene.screenSpaceCameraController.maximumZoomDistance = 3.0e7;   // max ~30,000 km

    viewer.imageryLayers.addImageryProvider(
      new Cesium.UrlTemplateImageryProvider({
        url: tileUrl,
        tilingScheme: new Cesium.GeographicTilingScheme(),
        rectangle: Cesium.Rectangle.fromDegrees(-180, -90, 180, 90),
        credit: "Mars 6.25° data via TiTiler + Flask",
      })
    );

    // Disable the distance-based fog entirely
    viewer.scene.fog.enabled = false;
    viewer.scene.globe.showGroundAtmosphere = false;
    if (viewer.scene.skyAtmosphere) {
      viewer.scene.skyAtmosphere.show = false;
    }

    const imageryLayer = viewer.imageryLayers.get(0);
    imageryLayer.alpha = 0.9;
    imageryLayer.brightness = 1.1;
    imageryLayer.saturation = 0.4;

    viewer.camera.flyTo({
      destination: Cesium.Cartesian3.fromDegrees(-133.3, 18.4, 3_500_000),
    });




    const handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);

// Create a simple HTML element to display coordinates
const coordLabel = document.createElement("div");
coordLabel.style.position = "absolute";
coordLabel.style.bottom = "10px";
coordLabel.style.left = "10px";
coordLabel.style.padding = "4px 8px";
coordLabel.style.background = "rgba(0,0,0,0.6)";
coordLabel.style.color = "white";
coordLabel.style.fontFamily = "monospace";
coordLabel.style.fontSize = "13px";
coordLabel.style.borderRadius = "4px";
document.body.appendChild(coordLabel);

handler.setInputAction(
  function (movement) {
    const ray = viewer.camera.getPickRay(movement.endPosition);
    const cartesian = viewer.scene.globe.pick(ray, viewer.scene);

    if (cartesian) {
      const cartographic = Cesium.Ellipsoid.WGS84.cartesianToCartographic(
        cartesian
      );

      const lat = Cesium.Math.toDegrees(cartographic.latitude).toFixed(5);
      const lon = Cesium.Math.toDegrees(cartographic.longitude).toFixed(5);
      const height = cartographic.height.toFixed(1);

      coordLabel.textContent = `Lon: ${lon}°, Lat: ${lat}°, H: ${height}m`;
    } else {
      coordLabel.textContent = "Off planet";
    }
  },
  Cesium.ScreenSpaceEventType.MOUSE_MOVE
);
  </script>
</body>

</html>